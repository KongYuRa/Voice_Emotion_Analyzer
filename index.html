<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŒì„± ê°ì • ë¶„ì„ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            text-align: center;
            max-width: 500px;
            width: 90%;
        }

        h1 {
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .upload-area {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.05);
        }

        .upload-area.dragover {
            border-color: #4ecdc4;
            background: rgba(78, 205, 196, 0.1);
        }

        #audioFile {
            display: none;
        }

        .upload-text {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .audio-player {
            margin: 20px 0;
            display: none;
        }

        audio {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .analyze-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin: 20px 0;
            display: none;
        }

        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .analyze-button.analyzing {
            background: linear-gradient(45deg, #ff6b6b, #ee5a5a);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .audio-visualizer {
            margin: 30px 0;
            height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding: 10px;
            gap: 2px;
        }

        .bar {
            width: 4px;
            background: linear-gradient(to top, #4ecdc4, #44a08d);
            border-radius: 2px;
            transition: height 0.1s ease;
        }

        .emotion-display {
            margin: 20px 0;
        }

        .emotion-result {
            font-size: 2em;
            font-weight: bold;
            margin: 15px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emotion-details {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: none;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .metric-label {
            flex: 1;
            text-align: left;
        }

        .metric-bar {
            flex: 2;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 10px;
        }

        .metric-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .metric-value {
            flex: 0 0 30px;
            text-align: right;
        }

        .happy { color: #ffd93d; }
        .sad { color: #74b9ff; }
        .excited { color: #fd79a8; }
        .calm { color: #00b894; }
        .angry { color: #e84393; }

        .status {
            margin: 20px 0;
            font-size: 1.1em;
            opacity: 0.8;
        }

        .file-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ ìŒì„± ê°ì • ë¶„ì„ê¸°</h1>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-text">ğŸ“ ì˜¤ë””ì˜¤ íŒŒì¼ ì—…ë¡œë“œ</div>
            <div class="upload-hint">í´ë¦­í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•´ì£¼ì„¸ìš”<br>(MP3, WAV, M4A ë“±)</div>
            <input type="file" id="audioFile" accept="audio/*">
        </div>

        <div class="file-info" id="fileInfo"></div>

        <div class="audio-player" id="audioPlayer">
            <audio id="audioElement" controls></audio>
        </div>

        <button class="analyze-button" id="analyzeButton">ğŸ” ê°ì • ë¶„ì„ ì‹œì‘</button>

        <div class="audio-visualizer" id="visualizer">
            <!-- ì˜¤ë””ì˜¤ ë°”ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
        </div>

        <div class="status" id="status">ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”</div>

        <div class="emotion-display">
            <div class="emotion-result" id="emotionResult">ğŸ˜Š íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ ê°ì •ì„ ë¶„ì„í•©ë‹ˆë‹¤</div>
            
            <div class="emotion-details" id="emotionDetails">
                <div class="metric">
                    <span class="metric-label">í‰ê·  ë³¼ë¥¨:</span>
                    <div class="metric-bar">
                        <div class="metric-fill" id="volumeBar" style="background: #74b9ff; width: 0%;"></div>
                    </div>
                    <span class="metric-value" id="volumeValue">0%</span>
                </div>
                
                <div class="metric">
                    <span class="metric-label">ì£¼íŒŒìˆ˜ ê°•ë„:</span>
                    <div class="metric-bar">
                        <div class="metric-fill" id="pitchBar" style="background: #fd79a8; width: 0%;"></div>
                    </div>
                    <span class="metric-value" id="pitchValue">0%</span>
                </div>
                
                <div class="metric">
                    <span class="metric-label">ìŒì„± ë³€í™”ëŸ‰:</span>
                    <div class="metric-bar">
                        <div class="metric-fill" id="variationBar" style="background: #00b894; width: 0%;"></div>
                    </div>
                    <span class="metric-value" id="variationValue">0%</span>
                </div>

                <div class="metric">
                    <span class="metric-label">ì—ë„ˆì§€ ë ˆë²¨:</span>
                    <div class="metric-bar">
                        <div class="metric-fill" id="energyBar" style="background: #ffd93d; width: 0%;"></div>
                    </div>
                    <span class="metric-value" id="energyValue">0%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class AudioEmotionAnalyzer {
            constructor() {
                this.audioContext = null;
                this.audioBuffer = null;
                this.isAnalyzing = false;
                
                this.uploadArea = document.getElementById('uploadArea');
                this.audioFile = document.getElementById('audioFile');
                this.audioPlayer = document.getElementById('audioPlayer');
                this.audioElement = document.getElementById('audioElement');
                this.analyzeButton = document.getElementById('analyzeButton');
                this.status = document.getElementById('status');
                this.emotionResult = document.getElementById('emotionResult');
                this.emotionDetails = document.getElementById('emotionDetails');
                this.visualizer = document.getElementById('visualizer');
                this.fileInfo = document.getElementById('fileInfo');
                
                this.analysisData = {
                    volume: 0,
                    pitch: 0,
                    variation: 0,
                    energy: 0,
                    zcr: 0,
                    tempo: 0,
                    voiceActivity: 0
                };

                this.initializeVisualizer();
                this.setupEventListeners();
            }

            initializeVisualizer() {
                // ì‹œê°í™”ë¥¼ ìœ„í•œ ë°” ìƒì„±
                for (let i = 0; i < 64; i++) {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = '10px';
                    this.visualizer.appendChild(bar);
                }
            }

            setupEventListeners() {
                // íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨
                this.uploadArea.addEventListener('click', () => {
                    this.audioFile.click();
                });

                this.audioFile.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFileUpload(e.target.files[0]);
                    }
                });

                // ë“œë˜ê·¸ ì•¤ ë“œë¡­
                this.uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.add('dragover');
                });

                this.uploadArea.addEventListener('dragleave', () => {
                    this.uploadArea.classList.remove('dragover');
                });

                this.uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    this.uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        this.handleFileUpload(files[0]);
                    }
                });

                // ë¶„ì„ ë²„íŠ¼
                this.analyzeButton.addEventListener('click', () => {
                    this.analyzeAudio();
                });
            }

            handleFileUpload(file) {
                if (!file.type.startsWith('audio/')) {
                    this.status.textContent = 'ì˜¤ë””ì˜¤ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
                    return;
                }

                // íŒŒì¼ ì •ë³´ í‘œì‹œ
                const fileSize = (file.size / 1024 / 1024).toFixed(2);
                this.fileInfo.innerHTML = `
                    <strong>íŒŒì¼ëª…:</strong> ${file.name}<br>
                    <strong>í¬ê¸°:</strong> ${fileSize} MB<br>
                    <strong>í˜•ì‹:</strong> ${file.type}
                `;
                this.fileInfo.style.display = 'block';

                // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ ì„¤ì •
                const fileURL = URL.createObjectURL(file);
                this.audioElement.src = fileURL;
                this.audioPlayer.style.display = 'block';
                this.analyzeButton.style.display = 'inline-block';
                
                this.status.textContent = 'íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!';
                this.emotionResult.textContent = 'ğŸ” ë¶„ì„ ì¤€ë¹„ ì™„ë£Œ';

                // ì˜¤ë””ì˜¤ ë²„í¼ ë¡œë”©
                this.loadAudioBuffer(file);
            }

            async loadAudioBuffer(file) {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const arrayBuffer = await file.arrayBuffer();
                    this.audioBuffer = await this.audioContext.decodeAudioData(arrayBuffer);
                    console.log('ì˜¤ë””ì˜¤ ë²„í¼ ë¡œë”© ì™„ë£Œ');
                } catch (error) {
                    console.error('ì˜¤ë””ì˜¤ ë¡œë”© ì˜¤ë¥˜:', error);
                    this.status.textContent = 'ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }
            }

            async analyzeAudio() {
                if (!this.audioBuffer) {
                    this.status.textContent = 'ë¨¼ì € ì˜¤ë””ì˜¤ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.';
                    return;
                }

                this.isAnalyzing = true;
                this.analyzeButton.textContent = 'ğŸ”„ ë¶„ì„ ì¤‘...';
                this.analyzeButton.classList.add('analyzing');
                this.status.textContent = 'ì˜¤ë””ì˜¤ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
                this.emotionDetails.style.display = 'block';

                try {
                    await this.performAnalysis();
                    this.visualizeAnalysis();
                    this.analyzeEmotion();
                } catch (error) {
                    console.error('ë¶„ì„ ì˜¤ë¥˜:', error);
                    this.status.textContent = 'ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                } finally {
                    this.isAnalyzing = false;
                    this.analyzeButton.textContent = 'ğŸ” ë‹¤ì‹œ ë¶„ì„í•˜ê¸°';
                    this.analyzeButton.classList.remove('analyzing');
                }
            }

            async performAnalysis() {
                const channelData = this.audioBuffer.getChannelData(0);
                const sampleRate = this.audioBuffer.sampleRate;
                const duration = this.audioBuffer.duration;
                
                // 1. ì •í™•í•œ RMS ë³¼ë¥¨ ê³„ì‚°
                let rmsSum = 0;
                const frameSize = 1024;
                const hopSize = 512;
                const frames = Math.floor((channelData.length - frameSize) / hopSize) + 1;
                const rmsValues = [];
                
                for (let frame = 0; frame < frames; frame++) {
                    const start = frame * hopSize;
                    let frameRMS = 0;
                    
                    for (let i = 0; i < frameSize && start + i < channelData.length; i++) {
                        frameRMS += channelData[start + i] ** 2;
                    }
                    
                    const rms = Math.sqrt(frameRMS / frameSize);
                    rmsValues.push(rms);
                    rmsSum += rms;
                }
                
                const avgRMS = rmsSum / frames;
                this.analysisData.volume = Math.min(avgRMS * 200, 100);
                
                // 2. ìŠ¤í™íŠ¸ëŸ´ ì¤‘ì‹¬ (Spectral Centroid) - ìŒì„±ì˜ ë°ê¸°
                let spectralCentroid = 0;
                let spectralEnergy = 0;
                
                const fftSize = 2048;
                const numFrames = Math.floor(channelData.length / fftSize);
                
                for (let frame = 0; frame < numFrames; frame += 4) { // ìƒ˜í”Œë§
                    const start = frame * fftSize;
                    const frameData = channelData.slice(start, start + fftSize);
                    
                    // ê°„ë‹¨í•œ FFT ëŒ€ì‹  ì£¼íŒŒìˆ˜ ì˜ì—­ ì¶”ì •
                    let lowFreqEnergy = 0;
                    let midFreqEnergy = 0;
                    let highFreqEnergy = 0;
                    
                    for (let i = 1; i < frameData.length; i++) {
                        const diff = Math.abs(frameData[i] - frameData[i-1]);
                        const energy = diff * diff;
                        
                        // ì£¼íŒŒìˆ˜ ëŒ€ì—­ ë¶„ë¥˜ (ì°¨ë¶„ í¬ê¸°ë¡œ ì¶”ì •)
                        if (diff < 0.01) {
                            lowFreqEnergy += energy;
                        } else if (diff < 0.05) {
                            midFreqEnergy += energy;
                        } else {
                            highFreqEnergy += energy;
                        }
                    }
                    
                    const totalEnergy = lowFreqEnergy + midFreqEnergy + highFreqEnergy;
                    if (totalEnergy > 0) {
                        spectralCentroid += (lowFreqEnergy * 0.3 + midFreqEnergy * 0.6 + highFreqEnergy * 0.9) / totalEnergy;
                        spectralEnergy += totalEnergy;
                    }
                }
                
                this.analysisData.pitch = Math.min((spectralCentroid / numFrames) * 150, 100);
                
                // 3. ì œë¡œ í¬ë¡œì‹± ë¹„ìœ¨ (Zero Crossing Rate) - ìŒì„±ì˜ ë…¸ì´ì¦ˆì„±
                let zeroCrossings = 0;
                for (let i = 1; i < channelData.length; i++) {
                    if ((channelData[i] >= 0) !== (channelData[i-1] >= 0)) {
                        zeroCrossings++;
                    }
                }
                const zcr = zeroCrossings / channelData.length;
                
                // 4. ë™ì  ë²”ìœ„ (Dynamic Range)
                const sortedRMS = [...rmsValues].sort((a, b) => a - b);
                const p10 = sortedRMS[Math.floor(sortedRMS.length * 0.1)];
                const p90 = sortedRMS[Math.floor(sortedRMS.length * 0.9)];
                const dynamicRange = p90 - p10;
                
                this.analysisData.variation = Math.min(dynamicRange * 1000, 100);
                
                // 5. ë¡¤ì˜¤í”„ ì£¼íŒŒìˆ˜ (Spectral Rolloff) - ì—ë„ˆì§€ ì§‘ì¤‘ë„
                this.analysisData.energy = Math.min((spectralEnergy / numFrames) * 100000, 100);
                
                // 6. ì¶”ê°€ íŠ¹ì„±ë“¤
                this.analysisData.zcr = Math.min(zcr * 50, 100);
                this.analysisData.tempo = this.estimateTempo(rmsValues, sampleRate / hopSize);
                this.analysisData.voiceActivity = this.estimateVoiceActivity(rmsValues, zcr);
                
                // ì‹œê°í™”ë¥¼ ìœ„í•œ ë”œë ˆì´
                await new Promise(resolve => setTimeout(resolve, 1500));
            }
            
            estimateTempo(rmsValues, frameRate) {
                // ê°„ë‹¨í•œ í…œí¬ ì¶”ì • (ìŒì„± ê°•ë„ ë³€í™” ë¹ˆë„)
                let peaks = 0;
                const threshold = rmsValues.reduce((a, b) => a + b, 0) / rmsValues.length * 1.5;
                
                for (let i = 1; i < rmsValues.length - 1; i++) {
                    if (rmsValues[i] > threshold && 
                        rmsValues[i] > rmsValues[i-1] && 
                        rmsValues[i] > rmsValues[i+1]) {
                        peaks++;
                    }
                }
                
                const duration = rmsValues.length / frameRate;
                return Math.min((peaks / duration) * 10, 100);
            }
            
            estimateVoiceActivity(rmsValues, zcr) {
                // ìŒì„± í™œë™ ê°ì§€ (RMSì™€ ZCR ì¡°í•©)
                const rmsThreshold = rmsValues.reduce((a, b) => a + b, 0) / rmsValues.length * 0.3;
                const activeFrames = rmsValues.filter(rms => rms > rmsThreshold).length;
                const activityRatio = activeFrames / rmsValues.length;
                
                // ZCRì´ ë„ˆë¬´ ë†’ìœ¼ë©´ ë…¸ì´ì¦ˆ, ë„ˆë¬´ ë‚®ìœ¼ë©´ ë¬´ìŒ
                const zcrScore = zcr > 0.05 && zcr < 0.3 ? 1 : 0.5;
                
                return Math.min(activityRatio * zcrScore * 100, 100);
            }

            visualizeAnalysis() {
                const bars = this.visualizer.children;
                
                // ëœë¤í•˜ê²Œ ë°” ë†’ì´ ì• ë‹ˆë©”ì´ì…˜ (ì‹¤ì œ ì£¼íŒŒìˆ˜ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜)
                for (let i = 0; i < bars.length; i++) {
                    const height = Math.random() * (this.analysisData.energy / 2) + 10;
                    bars[i].style.height = height + 'px';
                    
                    // ìƒ‰ìƒë„ ë°ì´í„°ì— ë”°ë¼ ë³€ê²½
                    if (height > 50) {
                        bars[i].style.background = 'linear-gradient(to top, #fd79a8, #fdcb6e)';
                    } else if (height > 30) {
                        bars[i].style.background = 'linear-gradient(to top, #4ecdc4, #44a08d)';
                    } else {
                        bars[i].style.background = 'linear-gradient(to top, #74b9ff, #0984e3)';
                    }
                }
            }

            analyzeEmotion() {
                const { volume, pitch, variation, energy, zcr, tempo, voiceActivity } = this.analysisData;
                
                // UI ì—…ë°ì´íŠ¸
                document.getElementById('volumeValue').textContent = Math.round(volume) + '%';
                document.getElementById('pitchValue').textContent = Math.round(pitch) + '%';
                document.getElementById('variationValue').textContent = Math.round(variation) + '%';
                document.getElementById('energyValue').textContent = Math.round(energy) + '%';
                
                document.getElementById('volumeBar').style.width = volume + '%';
                document.getElementById('pitchBar').style.width = pitch + '%';
                document.getElementById('variationBar').style.width = variation + '%';
                document.getElementById('energyBar').style.width = energy + '%';
                
                // ë¨¸ì‹ ëŸ¬ë‹ ê¸°ë°˜ì˜ ê°ì • ë¶„ì„ ë¡œì§
                const features = {
                    arousal: this.calculateArousal(volume, energy, tempo, variation),
                    valence: this.calculateValence(pitch, voiceActivity, volume),
                    dominance: this.calculateDominance(volume, energy, variation),
                    activation: this.calculateActivation(tempo, zcr, variation)
                };
                
                console.log('ê°ì • íŠ¹ì„± ë²¡í„°:', features);
                
                // ë‹¤ì°¨ì› ê°ì • ë¶„ë¥˜
                let emotion = 'ğŸ˜ ì¤‘ì„±ì ';
                let emotionClass = 'calm';
                let confidence = 0;
                
                // Russellì˜ ê°ì • ì›í™˜ ëª¨ë¸ ê¸°ë°˜ ë¶„ë¥˜
                if (features.arousal > 60 && features.valence > 55) {
                    if (features.activation > 70) {
                        emotion = 'ğŸ¤© ì—´ì •ì ';
                        emotionClass = 'excited';
                        confidence = Math.min(features.arousal + features.activation - 100, 100);
                    } else {
                        emotion = 'ğŸ˜Š ê¸°ì¨';
                        emotionClass = 'happy';
                        confidence = features.valence;
                    }
                } else if (features.arousal > 60 && features.valence < 45) {
                    if (features.dominance > 60) {
                        emotion = 'ğŸ˜  ë¶„ë…¸';
                        emotionClass = 'angry';
                        confidence = features.dominance;
                    } else {
                        emotion = 'ğŸ˜° ë¶ˆì•ˆ';
                        emotionClass = 'excited';
                        confidence = features.arousal - features.valence;
                    }
                } else if (features.arousal < 40 && features.valence < 40) {
                    emotion = 'ğŸ˜¢ ìŠ¬í””';
                    emotionClass = 'sad';
                    confidence = 80 - features.valence;
                } else if (features.arousal < 40 && features.valence > 60) {
                    emotion = 'ğŸ˜Œ í‰ì˜¨';
                    emotionClass = 'calm';
                    confidence = features.valence - features.arousal;
                } else if (features.activation > 65 && features.dominance > 55) {
                    emotion = 'ğŸ’ª ìì‹ ê°';
                    emotionClass = 'excited';
                    confidence = (features.activation + features.dominance) / 2;
                } else {
                    // ì„¸ë¶€ì ì¸ ì¤‘ê°„ ê°ì •ë“¤
                    if (features.valence > 50) {
                        emotion = 'ğŸ™‚ ê¸ì •ì ';
                        emotionClass = 'happy';
                    } else {
                        emotion = 'ğŸ˜• ë‹¤ì†Œ ë¶€ì •ì ';
                        emotionClass = 'sad';
                    }
                    confidence = Math.abs(features.valence - 50) * 2;
                }
                
                // ì‹ ë¢°ë„ í‘œì‹œ
                const confidenceText = confidence > 70 ? '(ë†’ì€ ì‹ ë¢°ë„)' : 
                                     confidence > 50 ? '(ë³´í†µ ì‹ ë¢°ë„)' : '(ë‚®ì€ ì‹ ë¢°ë„)';
                
                this.emotionResult.textContent = emotion + ' ' + confidenceText;
                this.emotionResult.className = 'emotion-result ' + emotionClass;
                this.status.innerHTML = `ë¶„ì„ ì™„ë£Œ! ì‹ ë¢°ë„: ${Math.round(confidence)}%<br>
                    <small>Arousal: ${Math.round(features.arousal)}% | Valence: ${Math.round(features.valence)}% | 
                    Dominance: ${Math.round(features.dominance)}% | Activation: ${Math.round(features.activation)}%</small>`;
            }
            
            calculateArousal(volume, energy, tempo, variation) {
                // ê°ì„±ë„: ì–¼ë§ˆë‚˜ í™œì„±í™”ëœ ìƒíƒœì¸ê°€
                return Math.min((volume * 0.3) + (energy * 0.3) + (tempo * 0.2) + (variation * 0.2), 100);
            }
            
            calculateValence(pitch, voiceActivity, volume) {
                // ì¾Œ/ë¶ˆì¾Œ: ê°ì •ì˜ ê¸ì •/ë¶€ì •ì„±
                const pitchScore = pitch > 40 ? pitch : Math.max(0, pitch - 20);
                const activityScore = voiceActivity > 60 ? voiceActivity * 0.8 : voiceActivity * 0.5;
                return Math.min((pitchScore * 0.4) + (activityScore * 0.3) + (volume * 0.3), 100);
            }
            
            calculateDominance(volume, energy, variation) {
                // ì§€ë°°ì„±: ì–¼ë§ˆë‚˜ í†µì œê°ì„ ê°–ê³  ìˆëŠ”ê°€
                const stabilityBonus = variation < 30 ? 20 : 0; // ì•ˆì •ì ì¸ ëª©ì†Œë¦¬ëŠ” ì§€ë°°ì 
                return Math.min((volume * 0.4) + (energy * 0.4) + (variation * 0.2) + stabilityBonus, 100);
            }
            
            calculateActivation(tempo, zcr, variation) {
                // í™œì„±í™” ì •ë„: ì–¼ë§ˆë‚˜ ì—­ë™ì ì¸ê°€
                const zcrScore = zcr > 20 && zcr < 80 ? zcr : zcr * 0.7; // ì ì ˆí•œ ZCRì´ ì¢‹ìŒ
                return Math.min((tempo * 0.4) + (zcrScore * 0.3) + (variation * 0.3), 100);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            new AudioEmotionAnalyzer();
        });
    </script>
</body>
</html>
